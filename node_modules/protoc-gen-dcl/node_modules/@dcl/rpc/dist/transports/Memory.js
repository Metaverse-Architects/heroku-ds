"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.MemoryTransport = void 0;
const mitt_1 = __importDefault(require("mitt"));
function MemoryTransport() {
    const clientEd = (0, mitt_1.default)();
    const serverEd = (0, mitt_1.default)();
    function configureMemoryTransport(receiver, sender) {
        return {
            ...sender,
            sendMessage(message) {
                receiver.emit("message", new Uint8Array(message));
            },
            close() {
                sender.emit("close", {});
                receiver.emit("close", {});
            },
        };
    }
    const client = configureMemoryTransport(clientEd, serverEd);
    const server = configureMemoryTransport(serverEd, clientEd);
    let connected = false;
    client.on("message", (message) => {
        if (!connected) {
            connected = true;
            client.emit("connect", {});
        }
    });
    return {
        client,
        server,
    };
}
exports.MemoryTransport = MemoryTransport;
//# sourceMappingURL=Memory.js.map